{% extends "base.html" %}

{% block title %}All Tasks{% endblock %}

{% block content %}
  <div class="content-wrapper">
    {% block content-header %}
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1><i class="fas fa-tasks"></i> All Tasks</h1>
            </div>
          </div>
        </div>
      </section>
    {% endblock %}     

    <section class="content">
      <div class="container-fluid">

        <div class="card card-outline card-primary mb-3">
          <div class="card-body">
            <form method="get" class="form-inline">
              <div class="form-group mr-3">
                <label for="status" class="mr-2">Status:</label>
                <select id="status" name="status" class="form-control">
                  <option value="">All</option>
                  <option value="done" {% if request.GET.status == "done" %}selected{% endif %}>Completed</option>
                  <option value="progress" {% if request.GET.status == "progress" %}selected{% endif %}>In progress</option>
                  <option value="overdue" {% if request.GET.status == "overdue" %}selected{% endif %}>Overdue</option>
                </select>
              </div>

              <div class="form-group mr-3">
                <label for="priority" class="mr-2">Priority:</label>
                <select id="priority" name="priority" class="form-control">
                  <option value="">All</option>
                  <option value="High" {% if request.GET.priority == "High" %}selected{% endif %}>High</option>
                  <option value="Medium" {% if request.GET.priority == "Medium" %}selected{% endif %}>Medium</option>
                  <option value="Low" {% if request.GET.priority == "Low" %}selected{% endif %}>Low</option>
                </select>
              </div>

              <button type="submit" class="btn btn-primary">
                <i class="fas fa-filter"></i> Filter
              </button>
            </form>
          </div>
        </div>

        <div class="card">
          <div class="card-header bg-primary text-white">
            <h3 class="card-title"><i class="fas fa-list"></i> Task List</h3>
          </div>
          <div class="card-body p-0">
            {% if tasks %}
              <table class="table table-striped table-hover mb-0">
                <thead class="thead-dark">
                  <tr>
                    <th>#</th>
                    <th>Task</th>
                    <th>Type</th>
                    <th>Priority</th>
                    <th>Deadline</th>
                    <th>Status</th>
                    <th>Assignees</th>
                  </tr>
                </thead>
                <tbody>
                  {% for task in tasks %}
                  <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>
                      <a href="">
                        {{ task.name }}
                      </a>
                    </td>
                    <td>{{ task.task_type.name }}</td>

                    <td>
                      {% if task.priority == "High" %}
                        <span class="badge bg-danger">High</span>
                      {% elif task.priority == "Medium" %}
                        <span class="badge bg-warning text-dark">Medium</span>
                      {% else %}
                        <span class="badge bg-success">Low</span>
                      {% endif %}
                    </td>

                    <td>{{ task.deadline|date:"d M Y" }}</td>

                    <td>
                      {% if task.is_completed %}
                        <span class="badge bg-success">Done</span>
                      {% elif task.deadline < now %}
                        <span class="badge bg-danger">Overdue</span>
                      {% else %}
                        <span class="badge bg-primary">In progress</span>
                      {% endif %}
                    </td>

                    <td>
                      {% for user in task.assignees.all %}
                        <span class="badge bg-secondary">{{ user.username }}</span>
                      {% empty %}
                        <span class="text-muted">â€”</span>
                      {% endfor %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <div class="p-3 text-muted">No tasks found.</div>
            {% endif %}
          </div>
        </div>

      </div>
    </section>
  </div>
{% endblock %}
